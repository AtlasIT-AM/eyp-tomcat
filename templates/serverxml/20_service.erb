
  <Service name="Catalina">

    <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
            maxThreads="<%= @maxThreads %>" minSpareThreads="<%= @minSpareThreads %>"/>

  <% if defined?(@connector_port) %>
    <Connector port="<%= @connector_port %>" protocol="HTTP/1.1"
               connectionTimeout="<%= @connectionTimeout %>"
               executor="tomcatThreadPool"
               <%- if defined?(@connector_http_server) -%>
               server="<%= @connector_http_server %>"
               <%- end -%>
               redirectPort="<%= @redirectPort %>" />
  <% end %>

  <% if defined?(@ajp_port) -%>
  <% if ! @ajp_port.to_s.empty? -%>
    <!-- Define an AJP 1.3 Connector on port 8009 -->
    <Connector port="<%= @ajp_port %>" protocol="AJP/1.3" redirectPort="<%= @redirectPort %>" />
      <% end -%>
  <% end -%>



    <Engine name="Catalina" defaultHost="localhost">

<% if @lockoutrealm -%>
      <!-- Use the LockOutRealm to prevent attempts to guess user passwords
           via a brute-force attack -->
      <Realm className="org.apache.catalina.realm.LockOutRealm">
<% end -%>
  <%- if @pwdigest == 'plaintext' -%>
        <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
               resourceName="UserDatabase"/>
  <%- else -%>
        <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
               resourceName="UserDatabase"
               digest="sha"/>
  <%- end -%>
<% if @lockoutrealm -%>
      </Realm>
<% end -%>

      <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true" <% if defined?(@errorReportValveClass) %>errorReportValveClass="<%= @errorReportValveClass %>" <% end %>>

        <!-- SingleSignOn valve, share authentication between web applications
             Documentation at: /docs/config/valve.html -->
        <!--
        <Valve className="org.apache.catalina.authenticator.SingleSignOn" />
        -->
  <% if(@realms) -%>
  <% @realms.each do | realm | -%>
        <Realm className="<%= realm %>" />
  <% end -%>
  <% end -%>

  <% if(@values) -%>
  <% @values.each do | valve | -%>
        <Value className="<%= valve %>" />
  <% end -%>
  <% end -%>


        <!-- Access log processes all example.
             Documentation at: /docs/config/valve.html
             Note: The pattern used is equivalent to using pattern="common" -->
        <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix="localhost_access_log." suffix=".txt"
               pattern="%h %l %u %t &quot;%r&quot; %s %b" />

      </Host>
    </Engine>
  </Service>
