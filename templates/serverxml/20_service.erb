
  <Service name="Catalina">

    <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
            maxThreads="<%= @maxThreads %>" minSpareThreads="<%= @minSpareThreads %>"/>

  <% if defined?(@connector_port) %>
    <Connector port="<%= @connector_port %>"
               protocol="HTTP/1.1"
               executor="tomcatThreadPool"
               enableLookups="<%= @connector_http_enable_lookups %>"
               disableUploadTimeout="<%= @connector_http_disable_upload_timeout %>"
               <%- if defined?(@connector_http_server) -%>
               server="<%= @connector_http_server %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_header_size) -%>
               maxHttpHeaderSize="<%= @connector_http_max_header_size %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_threads) -%>
               maxThreads="<%= @connector_http_max_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_min_spare_threads) -%>
               minSpareThreads="<%= @connector_http_min_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_spare_threads) -%>
               maxSpareThreads="<%= @connector_http_max_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_accept_count) -%>
               acceptCount="<%= @connector_http_accept_count %>"
               <%- end -%>
               <%- if defined?(@connector_http_connection_timeout) -%>
               connectionTimeout="<%= @connector_http_connection_timeout %>"
               <%- end -%>
               <%- if defined?(@connector_http_uri_encoding) -%>
               URIEncoding="<%= @connector_http_uri_encoding %>"
               <%- end -%>
               redirectPort="<%= @redirectPort %>" />
  <% end %>

  <% if defined?(@ajp_port) -%>
  <% if ! @ajp_port.to_s.empty? -%>
    <!-- Define an AJP 1.3 Connector on port 8009 -->
    <Connector port="<%= @ajp_port %>" protocol="AJP/1.3" redirectPort="<%= @redirectPort %>" />
      <% end -%>
  <% end -%>



    <Engine name="Catalina" defaultHost="localhost">

<% if @lockoutrealm -%>
      <!-- Use the LockOutRealm to prevent attempts to guess user passwords
           via a brute-force attack -->
      <Realm className="org.apache.catalina.realm.LockOutRealm">
<% end -%>
  <%- if @userdatabase -%>
  <%- if @pwdigest == 'plaintext' -%>
        <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
               resourceName="UserDatabase"/>
  <%- else -%>
        <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
               resourceName="UserDatabase"
               digest="sha"/>
  <%- end -%>
  <%- end -%>
<% if @lockoutrealm -%>
      </Realm>
<% end -%>

      <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true"
            <% if defined?(@xml_validation) %>xmlValidation="<%= @xml_validation %>"<% end -%>
            <% if defined?(@xml_namespace_aware) %>xmlNamespaceAware="<%= @xml_namespace_aware %>"<% end -%>
            <% if defined?(@errorReportValveClass) %>errorReportValveClass="<%= @errorReportValveClass %>" <% end -%>>

        <!-- SingleSignOn valve, share authentication between web applications
             Documentation at: /docs/config/valve.html -->
        <!--
        <Valve className="org.apache.catalina.authenticator.SingleSignOn" />
        -->
  <% if(@realms) -%>
  <% @realms.each do | realm | -%>
        <Realm className="<%= realm %>" />
  <% end -%>
  <% end -%>

  <% if(@values) -%>
  <% @values.each do | valve | -%>
        <Value className="<%= valve %>" />
  <% end -%>
  <% end -%>


        <!-- Access log processes all example.
             Documentation at: /docs/config/valve.html
             Note: The pattern used is equivalent to using pattern="common" -->
        <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix="localhost_access_log." suffix=".txt"
               pattern="%h %l %u %t &quot;%r&quot; %s %b" />
